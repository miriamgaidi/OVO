//Kode med foklaringen

// Kode kopiert og endret noe paa fra //https://create.arduino.cc/projecthub/muhammad-aqib/arduino-rgb-led-tutorial-fc003e 
//Finn ut hvor mye som er kopiert fra //https://www.instructables.com/Building-a-touch-sensor-low-cost/ 
//og boka 

#include <CapacitiveSensor.h>
CapacitiveSensor button = CapacitiveSensor(4,2); 

//definerer alle variabler 
int red_light_pin= 9; 
int blue_light_pin = 10;
int green_light_pin = 11;


int readValue = 0;
boolean isTouched = false;
int treshold = 1000; //forteller arduino når skal den finne en puls
//et høy tall reduserer sensitiviteten, men et mindre tall øker sensitiviteten til touch-funksjonen

void allLightsOff(){ //all lights turn off
  
      digitalWrite(red_light_pin, LOW);
      digitalWrite(blue_light_pin, LOW);
      digitalWrite(green_light_pin, LOW);
      delay(500); //liten pause
}

void setup() {
  pinMode(red_light_pin, OUTPUT);
  pinMode(green_light_pin, OUTPUT);
  pinMode(blue_light_pin, OUTPUT);
  Serial.begin(9600); // Arduino kommuniserer med Serial Monitor med en datahastighet på 9600 biter per sekund
}


void loop() {
  long sensorValue = button.capacitiveSensor(100); //setter value for knappen
  
  Serial.println(sensorValue);
  
  Serial.println(isTouched); 
  //hvis value som blir registrert er større enn 1000, og hvis lampen er skrudd av, så vil lampen sku seg på. 
  if (sensorValue > treshold && isTouched == false){
    isTouched = true;
  }
  //hvis value som blir registrert er større enn 1000, og hvis lampen er på fra før av, så vil lampen sku seg av. 
  else if(sensorValue > treshold && isTouched == true){
      isTouched = false;
      allLightsOff(); //alle LED-lys skal stoppe å lyse
  }

  if (isTouched){
  readValue = analogRead(A0); //potensiometer 

    //hvis det er nøytral så skal det lyses hvitt 
    if (204 > readValue){
      digitalWrite(red_light_pin, HIGH);
      digitalWrite(blue_light_pin, HIGH);
      digitalWrite(green_light_pin, HIGH);
    }
    
    //Hvis value er større enn 203, men mindre enn 410, så skal det lyses rødt
    if(203 < readValue && readValue < 410){
      digitalWrite(red_light_pin, HIGH);      
      digitalWrite(blue_light_pin, LOW);
      digitalWrite(green_light_pin, LOW);
      }
      
    //Hvis value er større enn 409, men mindre enn 615, så skal det lyses gult
    if(409 < readValue && readValue < 615){
      digitalWrite(red_light_pin, HIGH);      
      digitalWrite(blue_light_pin, LOW);
      digitalWrite(green_light_pin, HIGH);
      }

    //Hvis value er større enn 614, men mindre enn 820, så skal det lyses grønt
    if(614 < readValue && readValue < 820){
      digitalWrite(red_light_pin, LOW);      
      digitalWrite(blue_light_pin, LOW);
      digitalWrite(green_light_pin, HIGH);
      }

    //Hvis value er større enn 819, men mindre enn 1025, så skal det lyses blått    
    if(819 < readValue && readValue < 1025){
      digitalWrite(red_light_pin, LOW);      
      digitalWrite(blue_light_pin, HIGH);
      digitalWrite(green_light_pin, LOW);
      }
    delay(250);
  }
}
  

